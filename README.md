# **DNS Optimizer 🚀 (نسخه بازنویسی و ایمن شده)**

این پروژه یک اسکریپت Bash قدرتمند برای پیدا کردن سریع‌ترین و امن‌ترین سرور DNS برای اتصال اینترنت شما و تنظیم خودکار آن است. این ابزار با در نظر گرفتن بهترین شیوه‌های امنیتی و عملکردی بازنویسی شده است تا از هرگونه آسیب‌پذیری جلوگیری کند.

## **✨ ویژگی‌های کلیدی**

* **امنیت بالا:**  
  * بدون استفاده از دستورات خطرناک مانند eval.  
  * اجرای اسکریپت با حداقل دسترسی‌های لازم.  
  * ایمن‌سازی فایل‌های موقت و کانفیگ با سطوح دسترسی محدود.  
  * جلوگیری از حملات Race Condition با استفاده از flock.  
* **تست موازی و هوشمند:**  
  * تست همزمان چندین سرور DNS با کنترل تعداد پردازش‌ها برای جلوگیری از مصرف بیش از حد منابع.  
  * قابلیت تنظیم تعداد تست‌ها و دامنه‌ها برای هر سرور.  
* **سازگاری گسترده:**  
  * شناسایی خودکار توزیع‌های مختلف (Debian, Ubuntu, CentOS, Fedora, Arch) و نصب نیازمندی‌ها.  
  * پشتیبانی از systemd-resolved و مدیریت مستقیم /etc/resolv.conf.  
* **مدیریت آسان:**  
  * فایل کانفیگ خارجی و خوانا (/etc/dns-optimizer.conf).  
  * ایجاد خودکار پشتیبان از تنظیمات DNS قبل از هر تغییر.  
  * گزارش‌دهی (Logging) دقیق با قابلیت چرخش لاگ (Log Rotation).  
* **نصب و حذف خودکار:**  
  * اسکریپت install.sh هوشمند برای نصب، به‌روزرسانی و حذف کامل برنامه.  
* **اجرای زمان‌بندی شده:**  
  * راه‌اندازی خودکار به صورت دوره‌ای با استفاده از systemd timer برای به‌روز نگه داشتن DNSها.

## **🚀 نصب و راه‌اندازی**

برای نصب، کافیست دستور زیر را در ترمینال خود اجرا کنید. این اسکریپت به صورت هوشمند نیازمندی‌ها را بررسی و نصب کرده و سرویس‌ها را فعال می‌کند.

bash \-c "$(curl \-fsSL \[https://raw.githubusercontent.com/hamed00019/iran\_dns\_auto\_optimizer/main/install.sh\](https://raw.githubusercontent.com/hamed00019/iran\_dns\_auto\_optimizer/main/install.sh))"

**نکته:** اسکریپت نصب از شما درخواست رمز عبور sudo خواهد کرد، زیرا برای نصب فایل‌ها در مسیرهای سیستمی به دسترسی روت نیاز دارد.

## **📖 راهنمای استفاده**

اسکریپت dns-optimizer پس از نصب به صورت یک دستور سراسری در دسترس خواهد بود.

**ساختار دستور:** sudo dns-optimizer \[command\]

| دستور | توضیحات |
| :---- | :---- |
| run | **(پیش‌فرض)** اجرای بهینه‌سازی استاندارد بر اساس تنظیمات. |
| quick | اجرای بهینه‌سازی سریع (تست سرورهای با اولویت بالا و دامنه‌های کمتر). |
| full | اجرای بهینه‌سازی کامل (تست تمام سرورها و دامنه‌ها). |
| status | نمایش وضعیت فعلی DNS و سرویس زمان‌بندی. |
| restore | بازگردانی آخرین تنظیمات DNS از فایل پشتیبان. |
| log \[N\] | نمایش N خط آخر از فایل لاگ (پیش‌فرض: 20). |
| config | باز کردن فایل کانفیگ برای ویرایش با ویرایشگر پیش‌فرض. |
| help | نمایش این راهنما. |

**مثال‌ها:**

* **اجرای بهینه‌سازی استاندارد:**  
  sudo dns-optimizer run

* **مشاهده وضعیت فعلی:**  
  dns-optimizer status

* **بازگرداندن تنظیمات قبلی:**  
  sudo dns-optimizer restore

## **🛠️ شخصی‌سازی**

تمام تنظیمات اسکریپت، از جمله لیست سرورهای DNS، دامنه‌های تست، و پارامترهای عملکرد، در فایل زیر قابل تغییر هستند:  
/etc/dns-optimizer.conf  
برای ویرایش آسان این فایل، از دستور زیر استفاده کنید:

sudo dns-optimizer config

## **🗑️ حذف (Uninstall)**

برای حذف کامل اسکریپت، سرویس‌ها و فایل‌های کانفیگ، کافیست اسکریپت نصب را با آرگومان uninstall اجرا کنید:

bash \-c "$(curl \-fsSL \[https://raw.githubusercontent.com/hamed00019/iran\_dns\_auto\_optimizer/main/install.sh\](https://raw.githubusercontent.com/hamed00019/iran\_dns\_auto\_optimizer/main/install.sh))" \-- uninstall

این دستور تمام فایل‌های نصب شده و سرویس‌های systemd را به صورت کامل پاک‌سازی می‌کند.
